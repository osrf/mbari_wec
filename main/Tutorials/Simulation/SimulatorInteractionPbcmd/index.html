
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/Tutorials/Simulation/SimulatorInteractionPbcmd/">
      
      
        <link rel="prev" href="../SimulatorOutputLogs/">
      
      
        <link rel="next" href="../SimulatorParameters/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.39">
    
    
      
        <title>Control Simulator with pbcmd - MBARI-WEC</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#run-time-control-using-pbcmd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="MBARI-WEC" class="md-header__button md-logo" aria-label="MBARI-WEC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MBARI-WEC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Control Simulator with pbcmd
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="MBARI-WEC" class="md-nav__button md-logo" aria-label="MBARI-WEC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    MBARI-WEC
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ControlAndTelemetry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Buoy Control and Telemetry
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../atseaoperation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    At Sea Operation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ros2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROS 2 Interface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Install/Install_source/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install from source
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Install/Install_docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install using Docker
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" checked>
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Running the Simulator
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Running the Simulator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../RunSimulator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run the Simulator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimulatorOutputROS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    View ROS 2 Messages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimulatorOutputPlotjuggler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    View ROS 2 Messages with Plotjuggler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimulatorOutputLogs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulator Output Data Logs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Control Simulator with pbcmd
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Control Simulator with pbcmd
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pbcmd-usage" class="md-nav__link">
    <span class="md-ellipsis">
      pbcmd Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-descriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Command descriptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SimulatorParameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adjust Simulator parameters
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Adding Control Code
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            Adding Control Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/MessagesAndServices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ROS 2 Messages and Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/PythonTemplate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller GitHub Template (Python)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/CppTemplate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Controller GitHub Template (C++)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/PythonLinearDamperExample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Damper Example (Python)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/CppLinearDamperExample/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Damper Example (C++)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/CppOpenLoopControl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open-Loop Force Command Example (C++)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROS2/PythonOpenLoopControl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open-Loop Force Command Example (Python)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../theory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Theory
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../citation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Cite
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Roadmap
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pbcmd-usage" class="md-nav__link">
    <span class="md-ellipsis">
      pbcmd Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command-descriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Command descriptions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercises" class="md-nav__link">
    <span class="md-ellipsis">
      Exercises
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="run-time-control-using-pbcmd">Run-Time Control using pbcmd<a class="headerlink" href="#run-time-control-using-pbcmd" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>There is a command interpreter running on the physical buoy that provides some control over the
behavior of the buoy while it is deployed.  This is a Linux executable that implements a number of
commands, accepts appropriate arguments, and issues commands over the CANbus or ROS 2 on the buoy
to effect a change of buoy behavior.  These commands can also be issued programmatically as
described in subsequent tutorials, but pbcmd is the human interface.  </p>
<p>This same command and interface is implemented in the simulation environment, so it is possible to
change the behavior of the simulated buoy from the command line in the same way as can be done on
the physical buoy.  However many of the possible commands are not sensible in the simulated
environment, so are not implemented, but instead return a message indicating they aren't relevant
in simulation.  A key example is the command to open and close the heave-cone doors, because the
simulator can not change this behavior while running, the command to do so is inactive.  Similarly,
it makes no sense to turn on and off the electrical ground fault detector that exists on the buoy,
but does not exist in simulation.</p>
<h2 id="pbcmd-usage">pbcmd Usage<a class="headerlink" href="#pbcmd-usage" title="Permanent link">&para;</a></h2>
<p>Issuing 'pbcmd' at the command prompt provides guidance on the possible commands.  In simulation it
also indicates which commands are supported in simulation, on the at-sea system, all commands have
an effect.  </p>
<p>First source the workspace as usual:
<div class="highlight"><pre><span></span><code>$ cd /path/to/workspace
$ source install/setup.bash
</code></pre></div></p>
<p>Then, run <code>pbcmd</code> or any of the commands listed in its output:</p>
<div class="highlight"><pre><span></span><code>$ pbcmd

pbcmd: Multi-call command Power Buoy dispatcher
Commands currently supported in Simulation:
*               pump  - Spring Controller pump  off or on for a time in minutes &lt;= 10
*              valve  - Spring Controller valve off or on for a time in seconds &lt;= 12
*       sc_pack_rate  - Set the CANBUS packet rate from the spring controller
*           pc_Scale  - Set the scale factor
*         pc_Retract  - Set the retract factor
*        pc_WindCurr  - Set the winding current target
*        pc_BiasCurr  - Set the winding current bias
*        pc_PackRate  - Set the CANBUS packet rate

Commands currently not supported in Simulation:
*             bender  - Sets the state of the bender module
*      reset_battery  - Reset battery controller (caution - no args)

*             tether  - Spring Controller tether power on or off
*       reset_spring  - Reset Spring Controller (caution - no args)

*        pc_VTargMax  - Set the max target voltage
*   pc_ChargeCurrLim  - Set the maximum battery charge current
*     pc_DrawCurrLim  - Set the maximum battery current draw
*      pc_BattSwitch  - Set the battery switch state
*            pc_Gain  - Set the gain scheduler gain
*      pc_StdDevTarg  - Set the target RPM standard deviation

*          tf_SetPos  - Open/close the doors in the heave-cone
*    tf_SetActualPos  - Open/close the doors in the heave-cone
*         tf_SetMode  - Set controller mode
*   tf_SetChargeMode  - Set Battery Charge mode
* tf_SetStateMachine  - Set Battery Charge mode
*      tf_SetCurrLim  - Set controller current limit
*        tf_WatchDog  - Toggle controller watchdog (caution - no args)
*           tf_Reset  - Reset Controller (caution - no args)


For help on a command use the command name, i.e. &quot;bender&quot;;

Except the reset commands which take no arguments.

DO NOT enter reset_battery and expect to get help. The command will execute!
</code></pre></div>
<p>Note that at the end of this usage message, there is a hint that typing most commands without an
argument will supply some further help.</p>
<h2 id="command-descriptions">Command descriptions<a class="headerlink" href="#command-descriptions" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>pump</strong> - This command turns on and off the gas pump that pumps Nitrogen from the upper
pneumatic spring chamber to the lower spring chamber.  The result of this is the mean position of
the position will slowly rise.  The rate is about 1 inch per minute of pump action, a required
argument for this command specifies how long the pump will run for, in minutes, and must be between
0 and 10.  After this timeout the pump will stop even if no further commands are issued.  A
"pump 0" command stops the pump immediately.</p>
</li>
<li>
<p><strong>valve</strong> - The valve command releases Nitrogen gas from the lower chamber to the upper chamber,
resulting in the mean position of the piston lowering.  This process is much faster so the required
argument for this command is in seconds, and must be between 0 and 10.  After this timeout the
valve closes even if no further commands are issued.  A "valve 0" command closes the pump
immediately.</p>
</li>
<li>
<p><strong>sc_pack_rate</strong> - This command sets the data packet rate for data coming from the spring
controller, the required argument between 10 and 50 indicates the desired data rate in Hz.  This
controls the rate of the ROS 2 messages from the spring controller on the buoy, and in the
simulator.</p>
</li>
<li>
<p><strong>pc_scale</strong> - This command adjusts the multiplier that is applied to the default
motor-current/RPM relationship that is programmed into the power converter.  This value can be from
0.4 to 1.5, allowing a range of damping to be applied.</p>
</li>
<li>
<p><strong>pc_Retract</strong> - This command adjusts an additional multiplier that is applied to the default
motor-current/RPM relationship during piston retraction.  This value can be from 0.4 to 1.0, and
allows the damping behavior of the system to be asymmetrical, promoting retraction since the
pneumatic spring can not pull as hard as the waves can.</p>
</li>
<li>
<p><strong>pc_WindCurr</strong> - This command directly sets the winding current in the electric motor and
accepts a value between -35 Amps and +35 Amps.  This value is the quadrature current in the
permanent magnet electric motor, and therefore corresponds directly with applied torque. A positive
winding current produces a torque that applies a force that retracts the piston. The controller
applies this specified torque for two seconds.  After that time, if no new pc_WindCurr command is
executed, the system returns to following the default motor-current/RPM relationship (adjusted by
the Scale and Retract factor as described).  This allows safety in the case of a communication
failure, and makes it a bit impractical to manipulate the winding current manually from the
keyboard. As described in subsequent tutorials, programmatically adjusting this value in response
to the behavior of the wave-energy converter is the primary automated external control mechanism.</p>
</li>
<li>
<p><strong>pc_BiasCurr</strong> - This command applies an offset to the default motor-current/RPM relationship.<br />
This value can be between -15 Amps and +15 Amps and is applied for 10 seconds before the system
reverts to the default motor-current/RPM relationship.  A positive current corresponds to a torque
that tends to retract the piston.  This command is useful for temporarily changing the equilibrium
point of the piston at sea.</p>
</li>
<li>
<p><strong>pc_pack_rate</strong> - This command sets the data packet rate for data coming from the power
converter, the required argument between 10 and 50 indicates the desired data rate in Hz.  This
controls the rate of the ROS 2 messages from the power converter on the buoy, and in the simulator.</p>
</li>
</ul>
<h2 id="example-usage">Example Usage<a class="headerlink" href="#example-usage" title="Permanent link">&para;</a></h2>
<p>As an example, issue the following commands in a terminal <em>where the workspace has been sourced</em>:</p>
<ol>
<li>
<p>Launch the simulation without incident waves by issuing the following commands, the first
command over-rides the default sea-state and results in no incident wave-forcing on the buoy when
the "regenerate_models" flag is set to false:
<div class="highlight"><pre><span></span><code>$ empy -D &#39;inc_wave_spectrum_type=&quot;None&quot;&#39; -o ~/mbari_wec_ws/install/buoy_description/share/buoy_description/models/mbari_wec/model.sdf ~/mbari_wec_ws/install/buoy_description/share/buoy_description/models/mbari_wec/model.sdf.em

$ ros2 launch buoy_gazebo mbari_wec.launch.py regenerate_models:=false
</code></pre></div></p>
</li>
<li>
<p>Start the simulation in the GUI by pressing the play button.</p>
</li>
<li>
<p>Start PlotJuggler
<div class="highlight"><pre><span></span><code>$ ros2 run plotjuggler plotjuggler &amp;
</code></pre></div></p>
</li>
<li>
<p>Select messages wcurrent and rpm from the /power_data topic and the range_finder message from
the /spring_data topic, and then create plots to display these messages in separate windows.</p>
</li>
<li>
<p>Issue the following command to introduce a 10A winding current offset in the motor-current/RPM
relationship.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>$ pc_BiasCurr 10
</code></pre></div>
<ul>
<li>
<p>After 20 seconds of simulation time or so, the plotjuggler window should look approximately as
below.  One can see that the command resulted in an additional 10 Amps of motor winding current
being present (time = 6 seconds in plot), this additional torque spins the motor and a force is
applied to retract the piston, which is evident in the range_finder data.  </p>
</li>
<li>
<p>After a 10 second timeout, because no new current over-ride command is issued, the system reverts
to the default motor-current/RPM relationship that doesn't include the offset (time = 16 seconds in
plot).  After this extra torque is removed, the weight of the heave cone causes the piston to
extend back to it's nominal mean position causing the motor to spin in the opposite direction (time
= 16-20 seconds in the plot). The default motor-current/RPM relationship is programmed to resist
this motion and a smaller positive motor-current is applied during this time.  </p>
</li>
<li>
<p>After time = 21 seconds, the energy of the raised heave-cone has been dissipated into the PTO
system and the system comes mostly to rest.  The slow creep of the piston beyond 21 seconds is due
to the heating effects of the pneumatic spring, heat has been created in the gas spring which
slowly dissipates to the environment and the lower spring pressure drops slowly and lowers the
piston gradually.</p>
</li>
</ul>
<p><img alt="" src="../images/BiasCurrScreenshot.png" /></p>
<h2 id="exercises">Exercises<a class="headerlink" href="#exercises" title="Permanent link">&para;</a></h2>
<p>To extend the previous example, some interesting exercises to try are the following:</p>
<ul>
<li>
<p>Repeat the above example but also plot the battery voltage and current.  Observe how current
flows from the battery to raise the piston and heave cone when the pc_BiasCurr 10 command is
issued, and then when the timeout occurs, the potential energy of the raised heave cone is
converted to electrical energy and current flows into the battery, with a commensurate change in
battery voltage.</p>
</li>
<li>
<p>Plot the upper and lower spring pressures, observer how they change relative to piston position,
and their decay in time after the piston comes to rest.</p>
</li>
<li>
<p>Repeatedly issue the "pc_BiasCurr 10" command before the timeout expires, note how the timeout is
extended to 10 seconds beyond the last command issued.</p>
</li>
<li>
<p>Issue a "pc_WindCurr 10" command instead of the pc_BiasCurr command.  This command directly sets
the winding current, so the resulting winding current is not affected by the motor RPM until after
the timeout has expired.  For this command, the timeout is two seconds.</p>
</li>
<li>
<p>Plot other messages while manipulating the winding current.  Note how the buoy and heave-cone
positions as well as the load cell value respond to the dynamics of the floating bodies.</p>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.indexes", "navigation.tracking"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.525ec568.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="../../../js/extra.js"></script>
      
    
  </body>
</html>